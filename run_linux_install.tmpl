#!/bin/bash -x
# http://masterminds.github.io/sprig/  template docs. 
# chezmoi  data 
{{ if eq .chezmoi.os "linux" }}

export  https_proxy=http://114.116.248.206:1091
export  http_proxy=http://114.116.248.206:1091

echo "Install and configure for Ubuntu."

export  $(grep CODENAME /etc/os-release | xargs)

# install pre package for emacs
install_emacs_pre () {
    sudo apt-get install sqlite3
}

# install emacs
install_emacs () {
    sudo add-apt-repository -y ppa:kelleyk/emacs
    sudo apt-get install emacs27
}

# install pritunl
install_printul () {
    echo 'https://repo.pritunl.com/stable/apt $UBUNTU_CODENAME main' > /etc/apt/sources.list.d/pritunl.list
    
    sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv 7568D9BB55FF9E5287D586017AE645C0CF8E292A
    sudo apt-get update
    sudo apt-get install pritunl-client-electron
}

# install dropbox
install_dropbox () {
    wget https://www.dropbox.com/download?dl=packages/ubuntu/dropbox_2020.03.04_amd64.deb -O /tmp/dropbox.deb
    sudo dpkg -i /tmp/dropbox.deb
    sudo apt-get install -f
    sudo dpkg -i /tmp/dropbox.deb
    dropbox start -i
    dropbox autostart
    dropbox proxy manual http localhost 1091
}

# install ulauncher
install_ulauncher () {
    sudo add-apt-repository -y ppa:agornostal/ulauncher
    sudo apt-get install ulauncher
    sudo systemctl enable ulauncher
    sudo service ulauncher start
    # remember setting proxy for ulauncher to download extension.
    # install copyq  for clipmanager.
    # install extension https://github.com/friday/ulauncher-clipboard
    sudo add-apt-repository ppa:hluk/copyq
    sudo apt update
    sudo apt install copyq
}

# install rofi
install_rofi () {
    echo "start to install rofi,if you under 20.10 and want latest version, Please install from build."
    sudo apt-get install rofi
# build need many package extend in install docs.
#   apt-get install gcc make autoconf automake pkg-config flex bison check libxkbcommon0 libxkbcommon-dev  libglib2.0-dev  xcb  texinfo
# you should upgrade check to new under 20.10 ubuntu.
# https://github.com/libcheck/check
}

install_proxy_network () {
   echo "you should install and configure trojan"
   sudo apt-get install redsocks
   sudo cp -r etc/redsocks.conf  /etc/
   sudo cp -r etc/privoxy        /etc/
   sudo service redsocks restart
   sudo service privoxy  restart
   sudo ln -s ${PWD}/bin/proxy-set.sh  /usr/local/bin/
   sudo ln -s ${PWD}/bin/proxy-unset.sh  /usr/local/bin/
}

chmod +x ~/.emacs.d/bin/doom
~/.emacs.d/bin/doom  sync

dpkg -l |grep sqlite3                 || install_emacs_pre
dpkg -l |grep emacs27                 || install_emacs
dpkg -l |grep pritunl-client-electron || install_pritunl
which dropbox                         || install_dropbox
dpkg -l |grep ulauncher               || install_ulauncher
dpkg -l |grep rofi                    || install_rofi

{{ end }}




